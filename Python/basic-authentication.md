# Basic authentication

## Authentication Explained

Authentication is the process of verifying the identity of a user or a system. It is a crucial part of maintaining security and ensuring that only authorized users can access certain information or perform specific actions. 

### Understanding Authentication

Imagine you have a library card. When you go to the library, you need to show your card to borrow books. This card proves you are a member of the library. Similarly, in the digital world, authentication proves you are who you claim to be.

### Types of Authentication

1. **Password-Based Authentication**:
   - This is the most common type. A user provides a username and a password. If the password matches the one stored in the system, the user is authenticated.
   - **Example**: Logging into your email account by entering your email address and password.

2. **Multi-Factor Authentication (MFA)**:
   - This method uses two or more independent credentials: what the user knows (password), what the user has (security token), and what the user is (biometric verification).
   - **Example**: Using a password and a code sent to your phone to log in.

3. **Biometric Authentication**:
   - This method uses unique biological characteristics like fingerprints, facial recognition, or retina scans.
   - **Example**: Unlocking your smartphone with your fingerprint.

4. **Token-Based Authentication**:
   - This method uses a token generated by the system to verify a user's identity. Tokens can be time-based (expiring after a certain period) or session-based.
   - **Example**: An online banking system sending a one-time password (OTP) to your phone.

### How Authentication Works

When you log into a website, here's a simple process of how authentication works:

1. **User Input**:
   - You enter your username and password into a login form.
   
2. **Verification**:
   - The system checks if the username exists and if the password matches the stored password.

3. **Access Granted or Denied**:
   - If the credentials match, you gain access. If not, access is denied.

### Example Code Snippet

Here is a basic example of password-based authentication using Python:

```python
# A simple password-based authentication example

# Assume we have a user database
user_database = {
    "user1": "password123",
    "user2": "mypassword"
}

def authenticate(username, password):
    if username in user_database and user_database[username] == password:
        return "Authentication successful!"
    else:
        return "Authentication failed."

# User inputs
username = input("Enter your username: ")
password = input("Enter your password: ")

# Authentication process
result = authenticate(username, password)
print(result)
```

### Real-World Application

In real-world projects, authentication ensures secure access to applications and systems. For example, when you use online banking, authentication prevents unauthorized users from accessing your account. This protects your money and personal information.

### End of Chapter MCQs

1. **What is the primary purpose of authentication?**
   - A) To identify authorized users.
   - B) To store user data.
   - C) To speed up system processes.
   - D) To log user activities.

2. **Which of the following is NOT a type of authentication?**
   - A) Password-Based Authentication
   - B) Token-Based Authentication
   - C) Data Encryption
   - D) Biometric Authentication

3. **What does MFA stand for in the context of authentication?**
   - A) Multi-Function Application
   - B) Multi-Factor Authentication
   - C) Multi-Factor Analysis
   - D) Multi-Feature Authentication

4. **Which of the following is an example of biometric authentication?**
   - A) Password
   - B) Security Token
   - C) Fingerprint
   - D) One-Time Password (OTP)

5. **In the given code snippet, what will be printed if the user enters "user1" as the username and "password123" as the password?**
   - A) Authentication failed.
   - B) User not found.
   - C) Authentication successful!
   - D) Invalid input.

6. **What is the role of a token in token-based authentication?**
   - A) To encrypt user data
   - B) To verify a user's identity
   - C) To store user information
   - D) To log user activities

7. **Why is authentication important in online banking?**
   - A) To speed up transactions
   - B) To provide personalized services
   - C) To prevent unauthorized access
   - D) To improve user experience

8. **Which of the following is an example of multi-factor authentication (MFA)?**
   - A) Password only
   - B) Fingerprint only
   - C) Password and fingerprint
   - D) Username and email address

9. **What happens if the credentials do not match during the authentication process?**
   - A) Access is granted.
   - B) Access is denied.
   - C) The system crashes.
   - D) The user is logged out.

10. **Which type of authentication is most likely to use a security token?**
    - A) Password-Based Authentication
    - B) Token-Based Authentication
    - C) Biometric Authentication
    - D) Data Encryption

### Answers

1. A) To identify authorized users.
2. C) Data Encryption
3. B) Multi-Factor Authentication
4. C) Fingerprint
5. C) Authentication successful!
6. B) To verify a user's identity
7. C) To prevent unauthorized access
8. C) Password and fingerprint
9. B) Access is denied.
10. B) Token-Based Authentication

## Understanding Base64

Base64 is a method for encoding binary data into a text format using 64 different ASCII characters. It is commonly used to transmit binary data (like images, files, or multimedia content) over text-based protocols such as HTTP, email, and JSON. This encoding ensures that the data remains intact without modification during transport.

### Why Use Base64?

Binary data can contain characters that are not suitable for text-based protocols. By encoding binary data into a text representation using Base64, we ensure that the data can be safely transmitted over systems that handle text data. 

### How Base64 Works

Base64 encoding converts binary data into a string of ASCII characters. It uses a specific set of 64 characters, which includes:
- Uppercase letters (A-Z)
- Lowercase letters (a-z)
- Digits (0-9)
- Plus (+) and slash (/)

Each group of three bytes of binary data is divided into four groups of six bits. Each six-bit group is then mapped to one of the 64 characters.

### Example of Base64 Encoding

Let's take a simple example of encoding the string "hello" in Base64.

1. **Binary Representation**:
   - The ASCII values of the characters are:
     - `h` = 104, `e` = 101, `l` = 108, `l` = 108, `o` = 111
   - Convert these values to binary:
     - `h` = 01101000, `e` = 01100101, `l` = 01101100, `l` = 01101100, `o` = 01101111

2. **Combine the Binary Data**:
   - Combine the binary values into one continuous string:
     - 01101000 01100101 01101100 01101100 01101111

3. **Divide into 6-bit Groups**:
   - Split the combined binary data into 6-bit groups:
     - 011010, 000110, 010101, 101100, 011011, 000110, 1111

4. **Map to Base64 Characters**:
   - Convert each 6-bit group to its corresponding Base64 character:
     - 011010 = a, 000110 = G, 010101 = V, 101100 = s, 011011 = b, 000110 = G, 111100 = 8

   The Base64 encoded string for "hello" is "aGVsbG8=".

### Example Code Snippet

Here is a simple example in Python to encode and decode a string using Base64:

```python
import base64

# Encoding a string to Base64
original_string = "hello"
encoded_string = base64.b64encode(original_string.encode())
print("Encoded:", encoded_string)

# Decoding a Base64 string
decoded_string = base64.b64decode(encoded_string).decode()
print("Decoded:", decoded_string)
```

### Real-World Application

Base64 encoding is widely used in various real-world applications, such as:

- **Email Attachments**: Encoding files as Base64 ensures they can be sent as part of text-based email messages.
- **Data URIs in HTML**: Images and other resources can be embedded directly into HTML documents using Base64 encoding.
- **APIs**: Transmitting binary data such as files, images, or complex data structures through JSON or other text-based APIs.

### End of Chapter MCQs

1. **What is the primary purpose of Base64 encoding?**
   - A) To compress data
   - B) To convert binary data to text format
   - C) To encrypt data
   - D) To convert text data to binary format

2. **How many characters are used in Base64 encoding?**
   - A) 32
   - B) 64
   - C) 128
   - D) 256

3. **Which of the following characters is NOT used in Base64 encoding?**
   - A) A
   - B) +
   - C) /
   - D) %

4. **What is the Base64 encoded string for the word "cat"?**
   - A) Y2F0
   - B) bWFu
   - C) Y2Fy
   - D) bXk=

5. **Which Python module is commonly used for Base64 encoding and decoding?**
   - A) base64
   - B) binascii
   - C) codecs
   - D) encodings

6. **In Base64, how many bits are in each group before encoding?**
   - A) 4
   - B) 6
   - C) 8
   - D) 12

7. **What does the "=" symbol signify in a Base64 encoded string?**
   - A) Start of the string
   - B) End of the string
   - C) Padding
   - D) Delimiter

8. **Which real-world application uses Base64 encoding?**
   - A) Image compression
   - B) Video streaming
   - C) Email attachments
   - D) Text editing

9. **What is the binary representation of the Base64 character "T"?**
   - A) 011100
   - B) 010100
   - C) 101000
   - D) 100100

10. **Which function in Python decodes a Base64 encoded string?**
    - A) b64encode
    - B) b64decode
    - C) encode
    - D) decode

### Answers

1. B) To convert binary data to text format
2. B) 64
3. D) %
4. A) Y2F0
5. A) base64
6. B) 6
7. C) Padding
8. C) Email attachments
9. B) 010100
10. B) b64decode

## Encoding a String in Base64

Encoding a string in Base64 is a process of converting binary data into a text representation using 64 different ASCII characters. This is useful for transmitting data over text-based protocols.

### Step-by-Step Process

1. **Convert the String to Binary Data**:
   - Each character in a string is represented by an ASCII value.
   - Convert each ASCII value to its binary equivalent.

2. **Divide the Binary Data into 6-bit Groups**:
   - Combine all binary values into a single string.
   - Split the combined binary string into groups of 6 bits each.

3. **Map Each 6-bit Group to a Base64 Character**:
   - Use the Base64 index table to convert each 6-bit binary group to its corresponding Base64 character.

4. **Add Padding if Necessary**:
   - Base64 encoding requires that the output be a multiple of 4 characters.
   - Add padding characters (`=`) if necessary to make the output length a multiple of 4.

### Base64 Index Table

The Base64 index table maps 6-bit binary numbers to their corresponding characters:

```
ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/
```

### Example: Encoding "hello" in Base64

1. **Convert to Binary**:
   - "h" -> 104 -> 01101000
   - "e" -> 101 -> 01100101
   - "l" -> 108 -> 01101100
   - "l" -> 108 -> 01101100
   - "o" -> 111 -> 01101111

2. **Combine Binary Values**:
   ```
   01101000 01100101 01101100 01101100 01101111
   ```

3. **Divide into 6-bit Groups**:
   ```
   011010 000110 010101 101100 011011 000110 1111
   ```

4. **Map to Base64 Characters**:
   ```
   011010 -> a
   000110 -> G
   010101 -> V
   101100 -> s
   011011 -> b
   000110 -> G
   111100 -> 8
   ```

   Combined result: "aGVsbG8="

### Example Code Snippet

Here is how you can encode a string in Base64 using Python:

```python
import base64

def encode_to_base64(input_string):
    # Convert the input string to bytes
    byte_data = input_string.encode('utf-8')
    
    # Encode the byte data to Base64
    base64_encoded_data = base64.b64encode(byte_data)
    
    # Convert the Base64 byte data to string
    base64_string = base64_encoded_data.decode('utf-8')
    
    return base64_string

# Example usage
original_string = "hello"
encoded_string = encode_to_base64(original_string)
print("Original String:", original_string)
print("Base64 Encoded String:", encoded_string)
```

### Real-World Application

In real-world projects, encoding a string in Base64 is commonly used for:
- Sending email attachments.
- Storing data in XML or JSON formats.
- Embedding images in HTML or CSS files.

### End of Chapter MCQs

1. **What is the purpose of Base64 encoding?**
   - A) To compress data
   - B) To convert binary data to text format
   - C) To encrypt data
   - D) To improve performance

2. **How many bits are in each group during the Base64 encoding process?**
   - A) 4
   - B) 6
   - C) 8
   - D) 16

3. **Which character is used for padding in Base64 encoding?**
   - A) *
   - B) #
   - C) @
   - D) =

4. **What is the Base64 encoded string for "hi"?**
   - A) aGk=
   - B) aGVsbG8=
   - C) aGl=
   - D) aGVsbGk=

5. **Which Python module is used for Base64 encoding?**
   - A) base64
   - B) binascii
   - C) codecs
   - D) encodings

6. **What is the binary representation of the character 'a' in ASCII?**
   - A) 01100001
   - B) 01101000
   - C) 01100101
   - D) 01101111

7. **How many characters are used in Base64 encoding?**
   - A) 32
   - B) 64
   - C) 128
   - D) 256

8. **What is the Base64 encoded string for "cat"?**
   - A) Y2F0
   - B) Y2F=
   - C) Y2Fk
   - D) Y2Fy

9. **Which of the following characters is NOT used in Base64 encoding?**
   - A) A
   - B) +
   - C) /
   - D) %

10. **What is the first step in encoding a string in Base64?**
    - A) Add padding
    - B) Convert to binary
    - C) Map to Base64 characters
    - D) Divide into 6-bit groups

### Answers

1. B) To convert binary data to text format
2. B) 6
3. D) =
4. A) aGk=
5. A) base64
6. A) 01100001
7. B) 64
8. A) Y2F0
9. D) %
10. B) Convert to binary

## Understanding Basic Authentication

### What is Basic Authentication?

Basic Authentication is a simple and widely used method for an HTTP user agent (like a web browser) to provide a username and password when making a request. This method is commonly used in web applications and APIs to restrict access to certain resources.

### How Basic Authentication Works

1. **Client Request**: When a client (user) attempts to access a protected resource, the server responds with a `401 Unauthorized` status code and includes a `WWW-Authenticate` header indicating that Basic Authentication is required.

2. **User Credentials**: The client then prompts the user to enter a username and password.

3. **Encoding Credentials**: The client encodes the credentials in Base64 format. The credentials are formatted as `username:password` and then encoded to Base64.

4. **Authorization Header**: The client sends a new request with an `Authorization` header that includes the encoded credentials.

5. **Server Validation**: The server decodes the credentials and verifies them. If the credentials are valid, the server grants access to the resource; otherwise, it returns a `401 Unauthorized` status code.

### Example of Basic Authentication

Suppose a user wants to access a resource at `http://example.com/protected`. The process would look like this:

1. **Initial Request**:
   ```
   GET /protected HTTP/1.1
   Host: example.com
   ```

   **Server Response**:
   ```
   HTTP/1.1 401 Unauthorized
   WWW-Authenticate: Basic realm="Access to the protected site"
   ```

2. **Client Prompts for Credentials**: The user enters their username and password.

3. **Encoding Credentials**: Assume the username is `user` and the password is `pass`. The credentials `user:pass` are encoded in Base64 to `dXNlcjpwYXNz`.

4. **Authorization Header**:
   ```
   GET /protected HTTP/1.1
   Host: example.com
   Authorization: Basic dXNlcjpwYXNz
   ```

5. **Server Validation**: The server decodes the Base64 string to `user:pass` and verifies the credentials. If they are correct, the server responds with the requested resource.

### Example Code Snippet

Here is a simple example using Python with the `requests` library to perform Basic Authentication:

```python
import requests

# URL of the protected resource
url = 'http://example.com/protected'

# User credentials
username = 'user'
password = 'pass'

# Sending a request with Basic Authentication
response = requests.get(url, auth=(username, password))

# Checking the response
if response.status_code == 200:
    print('Access granted:', response.text)
else:
    print('Access denied:', response.status_code)
```

### Real-World Application

Basic Authentication is used in various scenarios, including:
- **Web APIs**: Restricting access to API endpoints.
- **Internal Tools**: Protecting internal applications and tools.
- **Early Stages**: Implementing simple authentication in the early stages of web application development.

### Security Considerations

While Basic Authentication is straightforward to implement, it is not secure by itself because the credentials are encoded in Base64, not encrypted. Therefore, it is important to always use HTTPS (HTTP Secure) to encrypt the data transmitted between the client and server.

### End of Chapter MCQs

1. **What does Basic Authentication require from the client?**
   - A) Token
   - B) Username and password
   - C) API key
   - D) Encryption key

2. **Which HTTP status code indicates that Basic Authentication is required?**
   - A) 200
   - B) 401
   - C) 403
   - D) 404

3. **How are the credentials formatted in Basic Authentication?**
   - A) JSON
   - B) XML
   - C) Plain text
   - D) Base64

4. **What header is used to include the encoded credentials in a request?**
   - A) Authorization
   - B) Authenticate
   - C) Credentials
   - D) Token

5. **In which header does the server indicate that Basic Authentication is required?**
   - A) Content-Type
   - B) WWW-Authenticate
   - C) Authorization
   - D) Accept

6. **Which protocol should be used to ensure the security of Basic Authentication?**
   - A) HTTP
   - B) FTP
   - C) HTTPS
   - D) SMTP

7. **What does the Base64 string 'dXNlcjpwYXNz' decode to?**
   - A) admin:admin
   - B) user:password
   - C) user:pass
   - D) username:password

8. **Which Python library can be used to perform Basic Authentication easily?**
   - A) urllib
   - B) http.client
   - C) requests
   - D) socket

9. **What does the server return if the credentials are invalid?**
   - A) 200 OK
   - B) 401 Unauthorized
   - C) 403 Forbidden
   - D) 404 Not Found

10. **Why is it important to use HTTPS with Basic Authentication?**
    - A) To compress data
    - B) To encrypt the transmitted data
    - C) To speed up the connection
    - D) To improve the user experience

### Answers

1. B) Username and password
2. B) 401
3. D) Base64
4. A) Authorization
5. B) WWW-Authenticate
6. C) HTTPS
7. C) user:pass
8. C) requests
9. B) 401 Unauthorized
10. B) To encrypt the transmitted data

## Sending the Authorization Header

### What is an Authorization Header?

The Authorization header is a part of the HTTP request that carries the credentials or token needed to authenticate the client with the server. This header is essential for securing access to protected resources and APIs.

### How to Send the Authorization Header

To send the Authorization header, follow these steps:

1. **Choose the Type of Authorization**:
   - **Basic Authentication**: Includes a username and password encoded in Base64.
   - **Bearer Token**: Includes a token that represents the user or client identity.
   - **API Key**: Includes an API key that the server recognizes.

2. **Format the Header Correctly**:
   - For **Basic Authentication**:
     ```
     Authorization: Basic <base64_encoded_credentials>
     ```
   - For **Bearer Token**:
     ```
     Authorization: Bearer <token>
     ```
   - For **API Key**:
     ```
     Authorization: ApiKey <api_key>
     ```

3. **Include the Header in the HTTP Request**:
   - Ensure the header is part of the HTTP request when accessing protected resources.

### Example: Sending the Authorization Header

#### Using Basic Authentication

1. **Prepare Credentials**:
   - Username: `user`
   - Password: `pass`
   - Encode `user:pass` to Base64: `dXNlcjpwYXNz`

2. **Send the HTTP Request**:

```python
import requests

url = 'http://example.com/protected'
username = 'user'
password = 'pass'

response = requests.get(url, auth=(username, password))

if response.status_code == 200:
    print('Access granted:', response.text)
else:
    print('Access denied:', response.status_code)
```

#### Using Bearer Token

1. **Get the Token**:
   - Token: `your_token_here`

2. **Send the HTTP Request**:

```python
import requests

url = 'http://example.com/protected'
token = 'your_token_here'

headers = {
    'Authorization': f'Bearer {token}'
}

response = requests.get(url, headers=headers)

if response.status_code == 200:
    print('Access granted:', response.text)
else:
    print('Access denied:', response.status_code)
```

#### Using API Key

1. **Get the API Key**:
   - API Key: `your_api_key_here`

2. **Send the HTTP Request**:

```python
import requests

url = 'http://example.com/protected'
api_key = 'your_api_key_here'

headers = {
    'Authorization': f'ApiKey {api_key}'
}

response = requests.get(url, headers=headers)

if response.status_code == 200:
    print('Access granted:', response.text)
else:
    print('Access denied:', response.status_code)
```

### Real-World Application

Sending the Authorization header is crucial for:
- **Accessing Web APIs**: Most APIs require some form of authentication.
- **Protecting Resources**: Ensuring only authorized users can access certain parts of an application.
- **User Authentication**: Validating user identity in web and mobile applications.

### End of Chapter MCQs

1. **What is the purpose of the Authorization header?**
   - A) To compress data
   - B) To authenticate the client
   - C) To cache data
   - D) To encrypt data

2. **Which of the following is NOT a type of Authorization header?**
   - A) Basic
   - B) Bearer
   - C) Digest
   - D) APIKey

3. **How are Basic Authentication credentials formatted before encoding?**
   - A) JSON
   - B) XML
   - C) `username:password`
   - D) Base64

4. **Which Python library is commonly used to send HTTP requests with Authorization headers?**
   - A) urllib
   - B) requests
   - C) socket
   - D) http.client

5. **What prefix is used in the Authorization header for a Bearer token?**
   - A) Basic
   - B) Bearer
   - C) Token
   - D) ApiKey

6. **What is the correct format for the Authorization header using an API key?**
   - A) `Authorization: ApiKey <api_key>`
   - B) `Authorization: Basic <api_key>`
   - C) `Authorization: Bearer <api_key>`
   - D) `Authorization: Key <api_key>`

7. **What HTTP status code indicates that access is granted?**
   - A) 200
   - B) 401
   - C) 403
   - D) 404

8. **What encoding method is used for Basic Authentication credentials?**
   - A) Hexadecimal
   - B) UTF-8
   - C) Base64
   - D) ASCII

9. **Which Authorization type typically involves sending a token?**
   - A) Basic
   - B) Bearer
   - C) APIKey
   - D) None

10. **What should you do if the server responds with a `401 Unauthorized` status code?**
    - A) Resend the request
    - B) Check and resend the Authorization header
    - C) Change the HTTP method
    - D) Ignore the response

### Answers

1. B) To authenticate the client
2. C) Digest
3. C) `username:password`
4. B) requests
5. B) Bearer
6. A) `Authorization: ApiKey <api_key>`
7. A) 200
8. C) Base64
9. B) Bearer
10. B) Check and resend the Authorization header

# Simple Basic API

## Overview
Creating a simple API involves setting up a web server, defining endpoints, and handling requests and responses. This guide will walk you through setting up a basic API using Flask, a lightweight web framework for Python, and demonstrate how to handle common HTTP status codes and authentication mechanisms.

### Setting Up the API
1. **Download and Start the Project:**
   - Unzip the project archive.
   - Install the required packages:
     ```sh
     pip3 install -r requirements.txt
     ```
   - Start the server:
     ```sh
     API_HOST=0.0.0.0 API_PORT=5000 python3 -m api.v1.app
     ```

2. **Testing the API:**
   - In another terminal or browser, test the API:
     ```sh
     curl "http://0.0.0.0:5000/api/v1/status" -vvv
     ```

### Error Handlers
Error handlers provide meaningful responses when things go wrong. Common HTTP status codes include 401 (Unauthorized) and 403 (Forbidden).

3. **401 Unauthorized Error:**
   - Add an error handler in `api/v1/app.py`:
     ```python
     from flask import jsonify

     @app.errorhandler(401)
     def unauthorized(error):
         return jsonify({"error": "Unauthorized"}), 401
     ```
   - Add a new endpoint to trigger this error in `api/v1/views/index.py`:
     ```python
     from flask import abort

     @app.route('/api/v1/unauthorized')
     def get_unauthorized():
         abort(401)
     ```

4. **403 Forbidden Error:**
   - Add an error handler in `api/v1/app.py`:
     ```python
     @app.errorhandler(403)
     def forbidden(error):
         return jsonify({"error": "Forbidden"}), 403
     ```
   - Add a new endpoint to trigger this error in `api/v1/views/index.py`:
     ```python
     @app.route('/api/v1/forbidden')
     def get_forbidden():
         abort(403)
     ```

### Authentication
Authentication ensures that users accessing the API are who they claim to be.

5. **Creating an Auth Class:**
   - Create the `Auth` class in `api/v1/auth/auth.py`:
     ```python
     from flask import request

     class Auth:
         def require_auth(self, path: str, excluded_paths: list) -> bool:
             return False

         def authorization_header(self, request=None) -> str:
             return None

         def current_user(self, request=None):
             return None
     ```

6. **Defining Routes That Don't Need Authentication:**
   - Update the `require_auth` method in `Auth` class:
     ```python
     def require_auth(self, path: str, excluded_paths: list) -> bool:
         if path is None or excluded_paths is None or not excluded_paths:
             return True
         if path in excluded_paths or path + '/' in excluded_paths:
             return False
         return True
     ```

7. **Request Validation:**
   - Update the `authorization_header` method in `Auth` class:
     ```python
     def authorization_header(self, request=None) -> str:
         if request is None or 'Authorization' not in request.headers:
             return None
         return request.headers.get('Authorization')
     ```
   - Add request filtering in `api/v1/app.py`:
     ```python
     auth = Auth()  # Initialize with your chosen auth mechanism

     @app.before_request
     def before_request():
         if auth is None:
             return
         excluded_paths = ['/api/v1/status/', '/api/v1/unauthorized/', '/api/v1/forbidden/']
         if not auth.require_auth(request.path, excluded_paths):
             return
         if auth.authorization_header(request) is None:
             abort(401)
         if auth.current_user(request) is None:
             abort(403)
     ```

### Basic Authentication
Basic authentication involves sending a Base64-encoded username and password with each request.

8. **BasicAuth Class:**
   - Create the `BasicAuth` class inheriting from `Auth`:
     ```python
     class BasicAuth(Auth):
         pass
     ```
   - Update `api/v1/app.py` to use `BasicAuth` based on the environment variable:
     ```python
     from api.v1.auth.basic_auth import BasicAuth

     if AUTH_TYPE == 'basic_auth':
         auth = BasicAuth()
     ```

9. **Extract Base64 Authorization Header:**
   - Add the method in `BasicAuth` class:
     ```python
     def extract_base64_authorization_header(self, authorization_header: str) -> str:
         if authorization_header is None or not isinstance(authorization_header, str) or not authorization_header.startswith("Basic "):
             return None
         return authorization_header[6:]
     ```

10. **Decode Base64 Authorization Header:**
    - Add the method in `BasicAuth` class:
      ```python
      import base64

      def decode_base64_authorization_header(self, base64_authorization_header: str) -> str:
          if base64_authorization_header is None or not isinstance(base64_authorization_header, str):
              return None
          try:
              return base64.b64decode(base64_authorization_header).decode('utf-8')
          except Exception:
              return None
      ```

11. **Extract User Credentials:**
    - Add the method in `BasicAuth` class:
      ```python
      def extract_user_credentials(self, decoded_base64_authorization_header: str) -> (str, str):
          if decoded_base64_authorization_header is None or not isinstance(decoded_base64_authorization_header, str) or ':' not in decoded_base64_authorization_header:
              return None, None
          return tuple(decoded_base64_authorization_header.split(':', 1))
      ```

12. **User Object from Credentials:**
    - Add the method in `BasicAuth` class:
      ```python
      def user_object_from_credentials(self, user_email: str, user_pwd: str):
          if user_email is None or not isinstance(user_email, str) or user_pwd is None or not isinstance(user_pwd, str):
              return None
          # Here you would retrieve the user object from your storage
          # For example:
          user = User.get(user_email)
          if user is None or not user.check_password(user_pwd):
              return None
          return user
      ```

## Testing Your Understanding
1. **What is the command to start the Flask server?**
   - `API_HOST=0.0.0.0 API_PORT=5000 python3 -m api.v1.app`

2. **Which HTTP status code represents unauthorized access?**
   - `401`

3. **What should the response contain for a 403 error handler?**
   - `{"error": "Forbidden"}`

4. **What is the purpose of the `authorization_header` method?**
   - To retrieve the `Authorization` header from the request.

5. **What does the `require_auth` method check?**
   - If the request path requires authentication.

6. **How do you test the API status in a terminal?**
   - `curl "http://0.0.0.0:5000/api/v1/status"`

7. **What does `BasicAuth` class inherit from?**
   - `Auth`

8. **What does `extract_base64_authorization_header` method return?**
   - The Base64 part of the `Authorization` header.

9. **Which module is used to decode Base64 in Python?**
   - `base64`

10. **What is the return type of `extract_user_credentials` method?**
    - A tuple containing the user email and password.

## Basic Authentication with Special Characters in Passwords

In this section, we will focus on improving a basic authentication method to handle passwords containing special characters, specifically the colon (`:`). This is a common requirement for secure password handling in web applications. We'll also explore how this can be applied in real-world projects.

### Extracting User Credentials

The goal is to enhance the `extract_user_credentials` method to correctly handle passwords that include the colon character. Typically, the colon separates the username from the password in the Basic Authentication scheme. Therefore, we need to ensure our method can parse this correctly even if the password contains colons.

Here is the implementation of the `extract_user_credentials` method:

```python
import base64

class BasicAuth:
    def extract_user_credentials(self, decoded_base64_authorization_header):
        """
        Extracts user credentials from the Base64 decoded authorization header.
        """
        if not decoded_base64_authorization_header or not isinstance(decoded_base64_authorization_header, str):
            return None, None
        
        # Split once to separate email and password correctly
        separator_index = decoded_base64_authorization_header.find(':')
        if separator_index == -1:
            return None, None
        
        user_email = decoded_base64_authorization_header[:separator_index]
        user_password = decoded_base64_authorization_header[separator_index + 1:]
        
        return user_email, user_password

# Example usage
basic_auth = BasicAuth()
decoded_base64 = "Ym9iMTAwQGhidG4uaW86SDBsYmVydG9uOlNjaG9vbDo5OCE="  # base64 for "bob100@hbtn.io:H0lberton:School:98!"
credentials = basic_auth.extract_user_credentials(base64.b64decode(decoded_base64).decode('utf-8'))
print(credentials)  # Output: ('bob100@hbtn.io', 'H0lberton:School:98!')
```

### Real-World Application

Handling passwords with special characters correctly is crucial for security and user experience. In a real-world project, ensuring proper parsing and storage of such passwords enhances the security of authentication mechanisms. This approach can be applied in various projects requiring secure user authentication, such as:

- E-commerce websites where users create accounts.
- Content management systems with multiple users.
- Any application involving sensitive user data.

### Multiple Choice Questions (MCQs)

To test your understanding, answer the following questions:

1. **What is the primary purpose of the `extract_user_credentials` method?**
   - A) To encode user credentials.
   - B) To decode Base64 encoded credentials and extract the email and password.
   - C) To hash the user's password.
   - D) To encrypt user credentials.

2. **Which character is used as a separator between the username and password in the Basic Authentication scheme?**
   - A) `;`
   - B) `|`
   - C) `:`
   - D) `&`

3. **What does the `find` method do in the context of the `extract_user_credentials` method?**
   - A) Encrypts the string.
   - B) Finds the position of the colon character.
   - C) Decodes the Base64 string.
   - D) Hashes the user's password.

4. **What happens if there is no colon found in the `decoded_base64_authorization_header`?**
   - A) An error is raised.
   - B) The method returns `None, None`.
   - C) The method returns the original string.
   - D) The method returns an empty string.

5. **In the context of the example usage, what is the Base64 encoded string for `bob100@hbtn.io:H0lberton:School:98!`?**
   - A) `Qm9iMTAwQGhidG4uaW86SDBsYmVydG9uOlNjaG9vbDo5OCE=`
   - B) `Ym9iMTAwQGhidG4uaW86SDBsYmVydG9uOlNjaG9vbDo5OCE=`
   - C) `Ym9iMTAwQGhidG4uaW86SDBsYmVydG9uOlNjaG9vbDo5!`
   - D) `Ym9iMTAwQGhidG4uaW86U2Nob29sOjk4IQ==`

6. **Why is it important to handle special characters in passwords correctly?**
   - A) To avoid database errors.
   - B) To enhance user experience.
   - C) To ensure secure and correct authentication.
   - D) All of the above.

7. **What is the output of the method if the `decoded_base64_authorization_header` is an empty string?**
   - A) `None, None`
   - B) An error is raised.
   - C) An empty string.
   - D) The original string.

8. **What should be the return value of `extract_user_credentials` if the `decoded_base64_authorization_header` is `bob@hbtn.io`?**
   - A) `(bob@hbtn.io, '')`
   - B) `(None, None)`
   - C) `(bob@hbtn.io, None)`
   - D) `('', None)`

9. **Which Python module is used for Base64 encoding and decoding in the provided code?**
   - A) `hashlib`
   - B) `base64`
   - C) `os`
   - D) `sys`

10. **How do you correctly decode a Base64 encoded string in Python?**
    - A) `base64.b64encode(string)`
    - B) `base64.b64decode(string)`
    - C) `string.decode('base64')`
    - D) `string.encode('base64')`

### Answers

1. B) To decode Base64 encoded credentials and extract the email and password.
2. C) `:`
3. B) Finds the position of the colon character.
4. B) The method returns `None, None`.
5. B) `Ym9iMTAwQGhidG4uaW86SDBsYmVydG9uOlNjaG9vbDo5OCE=`
6. D) All of the above.
7. A) `None, None`
8. B) `(None, None)`
9. B) `base64`
10. B) `base64.b64decode(string)`

---

## Allowing Wildcards in Excluded Paths

In this section, we will improve the `require_auth` method to support wildcards (`*`) at the end of excluded paths. This will allow more flexible authentication rules.

### Enhancing `require_auth` Method

Here is the implementation of the `require_auth` method with support for wildcards:

```python
class Auth:
    def require_auth(self, path, excluded_paths):
        """
        Determines if a given path requires authentication.
        """
        if path is None or not excluded_paths:
            return True
        
        for excluded_path in excluded_paths:
            if excluded_path.endswith('*'):
                if path.startswith(excluded_path[:-1]):
                    return False
            elif path == excluded_path:
                return False
        
        return True

# Example usage
auth = Auth()
excluded_paths = ["/api/v1/stat*"]
print(auth.require_auth("/api/v1/users", excluded_paths))  # Output: True
print(auth.require_auth("/api/v1/status", excluded_paths))  # Output: False
print(auth.require_auth("/api/v1/stats", excluded_paths))  # Output: False
```

### Real-World Application

Allowing wildcards in excluded paths can significantly simplify the management of authentication rules, especially in applications with numerous endpoints. This approach can be applied in:

- RESTful APIs where certain groups of endpoints follow the same authentication rules.
- Web applications with dynamic routing.
- Any scenario requiring flexible and scalable authentication configuration.

### Multiple Choice Questions (MCQs)

To test your understanding, answer the following questions:

1. **What is the purpose of the `require_auth` method?**
   - A) To encrypt user credentials.
   - B) To determine if a given path requires authentication.
   - C) To decode Base64 encoded strings.
   - D) To hash passwords.

2. **What does the wildcard (`*`) at the end of an excluded path signify?**
   - A) Any character can follow the path.
   - B) Only numbers can follow the path.
   - C) No characters can follow the path.
   - D) Only alphabetic characters can follow the path.

3. **What should the `require_auth` method return if `path` is `/api/v1/users` and `excluded_paths` is `["/api/v1/stat*"]`?**
   - A) `True`
   - B) `False`
   - C) `None`
   - D) An error

4. **In the context of `require_auth`, what does `excluded_path.endswith('*')` check for?**
   - A) If the path contains any special characters.
   - B) If the path ends with an asterisk (`*`).
   - C) If the path starts with a number.
   - D) If the path is empty.

5. **If `excluded_paths` is empty, what should the `require_auth` method return?**
   - A) `False`
   - B) `None`
   - C) `True`
   - D) An error

6. **What should the `require_auth` method return if `path` is `None

`?**
   - A) `True`
   - B) `False`
   - C) `None`
   - D) An error

7. **What does the `startswith` method do in the context of the `require_auth` method?**
   - A) Checks if the path ends with a specific character.
   - B) Checks if the path starts with a specific substring.
   - C) Splits the path into a list.
   - D) Encodes the path in Base64.

8. **What is the output of `auth.require_auth("/api/v1/stats", ["/api/v1/stat*"])`?**
   - A) `True`
   - B) `False`
   - C) `None`
   - D) An error

9. **Which method can be used to compare the start of a string in Python?**
   - A) `endswith`
   - B) `startswith`
   - C) `find`
   - D) `split`

10. **What should the `require_auth` method return if `path` is `/api/v1/status` and `excluded_paths` is `["/api/v1/stat*"]`?**
    - A) `True`
    - B) `False`
    - C) `None`
    - D) An error

### Answers

1. B) To determine if a given path requires authentication.
2. A) Any character can follow the path.
3. A) `True`
4. B) If the path ends with an asterisk (`*`).
5. C) `True`
6. A) `True`
7. B) Checks if the path starts with a specific substring.
8. B) `False`
9. B) `startswith`
10. B) `False`
